# Comparing `tmp/teelebot-2.3.1-py3-none-any.whl.zip` & `tmp/teelebot-2.3.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,22 +1,22 @@
-Zip file size: 40283 bytes, number of entries: 20
--rw-rw-rw-  2.0 fat     4093 b- defN 23-May-14 02:38 teelebot/__init__.py
+Zip file size: 40600 bytes, number of entries: 20
+-rw-rw-rw-  2.0 fat     4241 b- defN 23-May-15 07:38 teelebot/__init__.py
 -rw-rw-rw-  2.0 fat      165 b- defN 23-May-08 17:02 teelebot/__main__.py
--rw-rw-rw-  2.0 fat    32529 b- defN 23-May-14 17:03 teelebot/bot.py
+-rw-rw-rw-  2.0 fat    32825 b- defN 23-May-15 08:37 teelebot/bot.py
 -rw-rw-rw-  2.0 fat     7128 b- defN 23-May-14 14:32 teelebot/buffer.py
--rw-rw-rw-  2.0 fat     1556 b- defN 23-May-14 02:12 teelebot/common.py
--rw-rw-rw-  2.0 fat    23347 b- defN 23-May-14 17:40 teelebot/handler.py
+-rw-rw-rw-  2.0 fat     1581 b- defN 23-May-15 07:43 teelebot/common.py
+-rw-rw-rw-  2.0 fat    23796 b- defN 23-May-15 08:39 teelebot/handler.py
 -rw-rw-rw-  2.0 fat     1807 b- defN 23-May-03 00:00 teelebot/logger.py
 -rw-rw-rw-  2.0 fat     7059 b- defN 23-May-14 18:00 teelebot/metadata.py
 -rw-rw-rw-  2.0 fat      737 b- defN 23-May-14 14:25 teelebot/polling.py
--rw-rw-rw-  2.0 fat     3719 b- defN 23-May-14 14:27 teelebot/request.py
+-rw-rw-rw-  2.0 fat     3824 b- defN 23-May-15 05:04 teelebot/request.py
 -rw-rw-rw-  2.0 fat     4075 b- defN 23-May-14 14:30 teelebot/schedule.py
--rw-rw-rw-  2.0 fat      472 b- defN 23-May-14 17:03 teelebot/version.py
+-rw-rw-rw-  2.0 fat      472 b- defN 23-May-15 02:41 teelebot/version.py
 -rw-rw-rw-  2.0 fat     2665 b- defN 23-May-03 15:18 teelebot/webhook.py
--rw-rw-rw-  2.0 fat    35823 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/LICENSE
--rw-rw-rw-  2.0 fat     9630 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       43 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/entry_points.txt
--rw-rw-rw-  2.0 fat        9 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/top_level.txt
--rw-rw-rw-  2.0 fat        2 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/zip-safe
--rw-rw-r--  2.0 fat     1558 b- defN 23-May-14 18:04 teelebot-2.3.1.dist-info/RECORD
-20 files, 136509 bytes uncompressed, 37777 bytes compressed:  72.3%
+-rw-rw-rw-  2.0 fat    35823 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat     9700 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat       43 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/entry_points.txt
+-rw-rw-rw-  2.0 fat        9 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/top_level.txt
+-rw-rw-rw-  2.0 fat        2 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/zip-safe
+-rw-rw-r--  2.0 fat     1558 b- defN 23-May-15 08:51 teelebot-2.3.2.dist-info/RECORD
+20 files, 137602 bytes uncompressed, 38094 bytes compressed:  72.3%
```

## zipnote {}

```diff
@@ -33,29 +33,29 @@
 
 Filename: teelebot/version.py
 Comment: 
 
 Filename: teelebot/webhook.py
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/LICENSE
+Filename: teelebot-2.3.2.dist-info/LICENSE
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/METADATA
+Filename: teelebot-2.3.2.dist-info/METADATA
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/WHEEL
+Filename: teelebot-2.3.2.dist-info/WHEEL
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/entry_points.txt
+Filename: teelebot-2.3.2.dist-info/entry_points.txt
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/top_level.txt
+Filename: teelebot-2.3.2.dist-info/top_level.txt
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/zip-safe
+Filename: teelebot-2.3.2.dist-info/zip-safe
 Comment: 
 
-Filename: teelebot-2.3.1.dist-info/RECORD
+Filename: teelebot-2.3.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## teelebot/__init__.py

```diff
@@ -1,11 +1,11 @@
 # -*- coding:utf-8 -*-
 """
 @creation date: 2019-08-23
-@last modification: 2023-05-14
+@last modification: 2023-05-15
 """
 import os
 import requests
 import urllib3
 
 from .polling import _runUpdates
 from .webhook import _runWebhook
@@ -54,22 +54,24 @@
             protocol = "http://"
         url = f'{protocol}{str(bot._server_address)}:{str(bot._server_port)}/bot{str(bot._key)}'
         if (bot._drop_pending_updates == True and pending_update_count != 0) \
             or (status["url"] != url) or (status["has_custom_certificate"] != bot._self_signed) \
             or status["max_connections"] != int(bot._pool_size) \
             or allowed_updates != bot._allowed_updates:
             if bot._self_signed:
-                status = bot.setWebhook(
-                    url=url,
-                    certificate=bot._cert_pub,
-                    max_connections=bot._pool_size,
-                    allowed_updates=bot._allowed_updates,
-                    drop_pending_updates=bot._drop_pending_updates,
-                    secret_token=bot._secret_token
-                )
+                with open(bot._cert_pub, 'rb') as cert_pub:
+                    cert_pub_bytes = cert_pub.read()
+                    status = bot.setWebhook(
+                        url=url,
+                        certificate=cert_pub_bytes,
+                        max_connections=bot._pool_size,
+                        allowed_updates=bot._allowed_updates,
+                        drop_pending_updates=bot._drop_pending_updates,
+                        secret_token=bot._secret_token
+                    )
             else:
                 status = bot.setWebhook(
                     url=url,
                     max_connections=bot._pool_size,
                     allowed_updates=bot._allowed_updates,
                     drop_pending_updates=bot._drop_pending_updates,
                     secret_token=bot._secret_token
```

## teelebot/bot.py

```diff
@@ -1,12 +1,12 @@
 # -*- coding:utf-8 -*-
 """
 @description: A bot framework based on the Telegram Bot API
 @creation date: 2019-08-13
-@last modification: 2023-05-14
+@last modification: 2023-05-15
 @author: Pluto (github:plutobell)
 """
 import time
 import sys
 import os
 import copy
 import types
@@ -62,15 +62,21 @@
             self._self_signed = config["self_signed"]
             self._cert_key = config["cert_key"]
             self._cert_pub = config["cert_pub"]
             self._server_address = config["server_address"]
             self._server_port = config["server_port"]
             self._local_address = config["local_address"]
             self._local_port = config["local_port"]
-            self._secret_token = self.__make_token()
+            if "secret_token" in list(config.keys()):
+                if config["secret_token"] not in [None, "", " "]:
+                    self._secret_token = config["secret_token"]
+                else:
+                    self._secret_token = self.__make_token()
+            else:
+                self._secret_token = self.__make_token()
         self._offset = 0
         self._timeout = 60
         self._pool_size = config["pool_size"]
         self._buffer_size = config["buffer_size"]
         self._drop_pending_updates = config["drop_pending_updates"]
         self._updates_chat_member = config["updates_chat_member"]
         self._allowed_updates = []
@@ -392,15 +398,15 @@
     def __make_token(self, len=64):
         """
         Generate a token of the specified length
         """
         if len > 64:
             return "Specified length is too long."
         else:
-            token = ''.join(random.sample(f'{string.ascii_letters}{string.digits}-_', 64))
+            token = ''.join(random.sample(f'{string.ascii_letters}{string.digits}-_', len))
             return token
 
     def _pluginRun(self, bot, message):
         """
         Run plugin
         """
         if message is None:
```

## teelebot/common.py

```diff
@@ -1,10 +1,10 @@
 '''
 @creation date: 2023-05-13
-@last modification: 2023-05-14
+@last modification: 2023-05-15
 '''
 
 __cloud_api_server__ = "https://api.telegram.org/"
 __common_pkg_prefix__ = "~~"
 __inline_mode_prefix__ = "?:"
 
 __metadata_templates__ = {
@@ -45,22 +45,23 @@
     "[config]": "",
     "key": "",
     "root_id": "",
     "plugin_dir": "",
     "pool_size": "40",
     "buffer_size": "16",
     "debug": "False",
+    "proxy": "",
     "local_api_server": "False",
     "drop_pending_updates": "False",
     "updates_chat_member": "False",
     "webhook": "False",
     "self_signed": "False",
     "cert_key": "",
     "cert_pub": "",
     "server_address": "",
     "server_port": "",
     "local_address": "",
     "local_port": "",
-    "proxy": ""
+    "secret_token": ""
 }
```

## teelebot/handler.py

```diff
@@ -1,14 +1,15 @@
 # -*- coding:utf-8 -*-
 '''
 @creation date: 2019-08-23
 @last modification: 2023-05-15
 '''
 import configparser
 import argparse
+import re
 import os
 import sys
 import copy
 import shutil
 import requests
 
 from pathlib import Path
@@ -160,20 +161,27 @@
         print("Error in configuration file.")
         os._exit(0)
 
     if config["webhook"] == "True":
         webhook_args = ["self_signed",
                         "server_address", "server_port",
                         "local_address", "local_port",
-                        "cert_pub", "cert_key"]
+                        "cert_pub", "cert_key"] # Optional: secret_token
         for w in webhook_args:
             if w not in config.keys():
                 print("Please check if the following fields exist in the configuration file: \n" +
                     "cert_pub cert_key self_signed server_address server_port local_address local_port")
                 os._exit(0)
+        if "secret_token" in config.keys():
+            if config["secret_token"] not in [None, "", " "]:
+                pattern = r"^[A-Za-z0-9_-]{1,256}$"
+                if not re.match(pattern, config["secret_token"]):
+                    print("The format of secret_token is wrong (1-256 characters, only characters A-Z, a-z, 0-9, _ and - are allowed).")
+                    os._exit(0)
+            
 
     plugin_dir_in_config = False
     if "plugin_dir" in config.keys():
         if config["plugin_dir"] == "" or config["plugin_dir"] == None:
             print("Field plugin_dir is not set in configuration file.")
             os._exit(0)
         else:
```

## teelebot/request.py

```diff
@@ -1,12 +1,13 @@
 # -*- coding:utf-8 -*-
 '''
 @creation date: 2019-11-15
-@last modification: 2023-05-14
+@last modification: 2023-05-15
 '''
+import io
 import json
 import requests
 
 from .logger import _logger
 from traceback import extract_stack
 
 
@@ -72,14 +73,17 @@
         is_inputmedia = False
         inputmedia_param_name = "files"
         if method_name in inputmedia_methods:
             is_inputmedia = True
 
         data, files = {}, {}
         for key, value in kwargs.items():
+            if isinstance(value, io.BufferedReader):
+                value = value.read()
+
             if not is_inputmedia and key == inputmedia_param_name:
                 pass
             elif is_inputmedia and key == inputmedia_param_name:
                 files = value
             elif isinstance(value, bytes):
                 files[key] = value
             elif isinstance(value, dict):
```

## teelebot/version.py

```diff
@@ -2,15 +2,15 @@
 """
 @description: A bot framework based on the Telegram Bot API
 @creation date: 2019-11-15
 @last modification: 2023-05-15
 @author: Pluto (github:plutobell)
 """
 
-__version__ = "2.3.1"
+__version__ = "2.3.2"
 
 __author__ = "Pluto"
 __email__ = "hi@ojoll.com"
 __blog__ = "https://ojoll.com"
 __github__ = "https://github.com/plutobell/teelebot"
 __description__ = "teelebot is a robot framework based on Telegram Bot API, with plug-in system, easy to extend."
```

## Comparing `teelebot-2.3.1.dist-info/LICENSE` & `teelebot-2.3.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `teelebot-2.3.1.dist-info/METADATA` & `teelebot-2.3.2.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: teelebot
-Version: 2.3.1
+Version: 2.3.2
 Summary: teelebot is a robot framework based on Telegram Bot API, with plug-in system, easy to extend.
 Home-page: https://ojoll.com
 Author: Pluto
 Author-email: hi@ojoll.com
 License: GPLv3
 Keywords: teelebot telegram bot telegram bot api telegram
 Classifier: Programming Language :: Python :: 3
@@ -199,14 +199,15 @@
 self_signed=False
 cert_key=your private cert path
 cert_pub=your public cert path
 server_address=your server ip address or domain
 server_port=your server port
 local_address=webhook local address
 local_port=webhook local port
+secret_token=webhook secret token
 ```
 
 `self_signed` 用于设置是否使用自签名证书，而 `cert_key` 和 `cert_pub` 则是你的证书路径(绝对路径)，`server_address` 为你的服务器公网IP, `server_port` 为服务器的端口(目前 telegram 官方仅支持 443,  80,  88,  8443)，`local_address` 为Webhook 本地监听地址， `local_port` 为 Webhook 本地运行的端口。
 
 自签名证书生成请参考：[Generating a self-signed certificate pair (PEM)](https://core.telegram.org/bots/self-signed#generating-a-self-signed-certificate-pair-pem)
 
 
@@ -292,14 +293,15 @@
 self_signed=False # Optional while webhook is False
 cert_key=your private cert path # Optional while webhook is False
 cert_pub=your public cert path # Optional while webhook is False
 server_ip=your server ip address # Optional while webhook is False
 server_port=your server port # Optional while webhook is False
 local_address=webhook local address # Optional while webhook is False
 local_port=webhook local port # Optional while webhook is False
+secret_token=webhook secret token
 debug=False
 drop_pending_updates=False
 local_api_server=local api server address # [Optional]
 updates_chat_member=False # [Optional]
 proxy=socks5h://user:pass@host:port # [Optional]
 ```
```

### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: teelebot Version: 2.3.1 Summary: teelebot is a
+Metadata-Version: 2.1 Name: teelebot Version: 2.3.2 Summary: teelebot is a
 robot framework based on Telegram Bot API, with plug-in system, easy to extend.
 Home-page: https://ojoll.com Author: Pluto Author-email: hi@ojoll.com License:
 GPLv3 Keywords: teelebot telegram bot telegram bot api telegram Classifier:
 Programming Language :: Python :: 3 Classifier: Operating System :: OS
 Independent Classifier: License :: OSI Approved :: GNU General Public License
 v3 (GPLv3) Requires-Python: >=3.6 Description-Content-Type: text/markdown
 License-File: LICENSE Requires-Dist: requests
@@ -54,17 +54,17 @@
 æ¨¡å¼è¿è¡ãçäº§ç¯å¢æ¨èä½¿ç¨ `Webhook` æ¨¡å¼ï¼è `Polling`
 åä»ç¨äºå¼åç¯å¢ã ##### 1ãWebhook æ¨¡å¼ è¦ä»¥ `Webhook`
 æ¨¡å¼è¿è¡ï¼è¯·å°éç½®æä»¶å­æ®µ `webhook` è®¾ç½®ä¸º `True`
 ï¼æ­¤æ¨¡å¼æ¶åçéç½®æä»¶å­æ®µå¦ä¸ï¼ ```python [config]
 webhook=True self_signed=False cert_key=your private cert path cert_pub=your
 public cert path server_address=your server ip address or domain
 server_port=your server port local_address=webhook local address
-local_port=webhook local port ``` `self_signed`
-ç¨äºè®¾ç½®æ¯å¦ä½¿ç¨èªç­¾åè¯ä¹¦ï¼è `cert_key` å `cert_pub`
-åæ¯ä½ çè¯ä¹¦è·¯å¾(ç»å¯¹è·¯å¾)ï¼`server_address`
+local_port=webhook local port secret_token=webhook secret token ```
+`self_signed` ç¨äºè®¾ç½®æ¯å¦ä½¿ç¨èªç­¾åè¯ä¹¦ï¼è `cert_key` å
+`cert_pub` åæ¯ä½ çè¯ä¹¦è·¯å¾(ç»å¯¹è·¯å¾)ï¼`server_address`
 ä¸ºä½ çæå¡å¨å¬ç½IP, `server_port` ä¸ºæå¡å¨çç«¯å£(ç®å telegram
 å®æ¹ä»æ¯æ 443, 80, 88, 8443)ï¼`local_address` ä¸ºWebhook
 æ¬å°çå¬å°åï¼ `local_port` ä¸º Webhook æ¬å°è¿è¡çç«¯å£ã
 èªç­¾åè¯ä¹¦çæè¯·åèï¼[Generating a self-signed certificate pair
 (PEM)](https://core.telegram.org/bots/self-signed#generating-a-self-signed-
 certificate-pair-pem) ##### 2ãPolling æ¨¡å¼ è¦ä»¥ Polling
 æ¨¡å¼è¿è¡ï¼åªéè¦ä¿è¯éç½®æä»¶ `webhook` å­æ®µä¸º `False`
@@ -92,17 +92,18 @@
 size, default 40, range(1, 101) buffer_size=16 # the buffer area size, default
 16(MB) webhook=False self_signed=False # Optional while webhook is False
 cert_key=your private cert path # Optional while webhook is False cert_pub=your
 public cert path # Optional while webhook is False server_ip=your server ip
 address # Optional while webhook is False server_port=your server port #
 Optional while webhook is False local_address=webhook local address # Optional
 while webhook is False local_port=webhook local port # Optional while webhook
-is False debug=False drop_pending_updates=False local_api_server=local api
-server address # [Optional] updates_chat_member=False # [Optional]
-proxy=socks5h://user:pass@host:port # [Optional] ``` **å¨ `1.13.0`
+is False secret_token=webhook secret token debug=False
+drop_pending_updates=False local_api_server=local api server address #
+[Optional] updates_chat_member=False # [Optional] proxy=socks5h://user:
+pass@host:port # [Optional] ``` **å¨ `1.13.0`
 åä»¥ä¸çæ¬ï¼æ¯æèªå¨çæéç½®æä»¶ãï¼é»è®¤ä¸ºPollingæ¨¡å¼ï¼**
 1.å¨å½ä»¤è¡æªæå®éç½®æä»¶è·¯å¾çæåµä¸ï¼ä¼å¨é»è®¤éç½®æä»¶è·¯å¾ä¸ä¸å­å¨éç½®æä»¶æ¶èªå¨çæéç½®æä»¶
 `config.cfg`ã * å¨Linuxä¸ï¼ä¼èªå¨å¨ç¨æ·ç®å½ä¸åå»ºæä»¶å¤¹
 `.teelebot` ï¼å¹¶çæéç½®æä»¶ `config.cfg` * å¨Windowsä¸ï¼åä¼å¨
 `C:\Users\` ç®å½ä¸åå»ºæä»¶å¤¹ `.teelebot` ï¼å¹¶çæéç½®æä»¶
 `config.cfg` 2.æå®éç½®æä»¶ Linux å Windows
 é½å¯å¨å½ä»¤è¡éè¿åæ°æå¨æå®éç½®æä»¶è·¯å¾ï¼å½ä»¤æ ¼å¼ï¼
```

